<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org" th:replace="~{fragmentos/plantilla-maestra::html(~{::title}, ~{::body})}">
    <head>
        <title>Bios Work - Consultores</title>
    </head>
    <body th:remove="tag">
        <h1>Consultores</h1>

        <p th:replace="~{fragmentos/parrafo-mensaje}"></p>

        <form id="formularioBusqueda">
            <div>
                <input type="search" name="criterio" th:value="${param.criterio}" id="criterio" placeholder="Nombre de usuario"> <input type="submit" value="Buscar">
            </div>
        </form>

        <p><a th:href="@{/consultores/agregar}" title="Agregar"><i class="icono icono-agregar"></i></a></p>

        <table class="listado">
            <tr>
                <th>NOMBRE DE USUARIO</th><th></th>
            </tr>
            <tr th:each="p : ${consultores}">
                <td th:text="${p.nombreUsuario}" class="texto-centro"></td>
                
                <td>
                    <a th:href="@{/consultores/{nombreUsuario}(nombreUsuario=${p.nombreUsuario})}" title="Ver Detalle"><i class="icono icono-ver"></i></a>&nbsp;&nbsp;
                    <a th:href="@{/consultores/modificar(nombreUsuario=${p.nombreUsuario})}" title="Modificar"><i class="icono icono-modificar"></i></a>&nbsp;&nbsp;
                    <a th:href="@{/consultores/eliminar(nombreUsuario=${p.nombreUsuario})}" title="Eliminar" class="boton-eliminar" th:data-nombreUsuario="${p.nombreUsuario}"><i class="icono icono-eliminar"></i></a>
                </td>
            </tr>
        </table>

        <p>Cantidad de consultores: <span th:text="${consultores.size()}"></span></p>

        <dialog id="dialogoEliminar" class="texto-centro">
            <p>Â¿Confirma que desea eliminar el consultor con nombre de usuario <strong id="etiquetaNombreUsuarioEliminar"></strong><br />(<span id="etiquetaDescripcionEliminar"></span>)?</p>

            <form th:action="@{/consultores/eliminar}" method="post">
                <input type="hidden" name="nombreUsuario" id="campoNombreUsuarioEliminar" />

                <div>
                    <input type="button" value="Cancelar" id="botonCancelarEliminar" />&nbsp;&nbsp;&nbsp;<input type="submit" value="Eliminar" />
                </div>
            </form>
        </dialog>

        <script>
            document.getElementById('formularioBusqueda').addEventListener('search', function() {
                if (!document.getElementById('criterio').value) {
                    window.location = '/productos';
                }
            });

            Array.from(document.getElementsByClassName('boton-eliminar')).forEach(element => {
                element.addEventListener('click', function(event) {
                    event.preventDefault();

                    document.getElementById('etiquetaCodigoEliminar').innerHTML = element.dataset.codigo;
                    document.getElementById('etiquetaDescripcionEliminar').innerHTML = element.dataset.descripcion;
                    document.getElementById('campoCodigoEliminar').value = element.dataset.codigo;
                    document.getElementById('dialogoEliminar').showModal();
                });
            });

            document.getElementById('botonCancelarEliminar').addEventListener('click', function() {
                document.getElementById('dialogoEliminar').close();
            });

            document.getElementById('criterio').focus();
            document.getElementById('criterio').select();
        </script>
    </body>
</html>